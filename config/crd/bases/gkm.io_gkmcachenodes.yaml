---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: gkmcachenodes.gkm.io
spec:
  group: gkm.io
  names:
    kind: GKMCacheNode
    listKind: GKMCacheNodeList
    plural: gkmcachenodes
    singular: gkmcachenode
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.nodeName
      name: Node
      type: string
    - jsonPath: .status.counts.nodeInUseCnt
      name: Node-In-Use
      type: string
    - jsonPath: .status.counts.nodeNotInUseCnt
      name: Node-Not-In-Use
      type: string
    - jsonPath: .status.counts.nodeErrorCnt
      name: Node-Error
      type: string
    - jsonPath: .status.counts.podRunningCnt
      name: Pod-Running
      type: string
    - jsonPath: .status.counts.podOutdatedCnt
      name: Pod-Outdated
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          GKMCacheNode contains the state on a given Kubernetes Node of the set of
          GKMCache instances created in the same Namespace. When one or more GKMCache
          instance are created in a namespace, GKM ensures that one GKMCacheNode
          instance is created per Kubernetes Node. GKMCacheNode cannot be edited by an
          application or user, only by GKM.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          status:
            description: |-
              status reflects the observed state of a GKMCacheNode instance and indicates
              if each GKMCache instance in this Namespace and on the node referenced by
              status.nodeName has been loaded successfully or not and if it has been
              mounted in any pods on the node.
            properties:
              caches:
                additionalProperties:
                  additionalProperties:
                    properties:
                      compatibleGPUs:
                        description: |-
                          compatibleGPUs is the list of GPU ids that the extracted GPU Kernel Cache
                          is compatible with. The ids refer back to the list of GPUs in status.gpus.
                        items:
                          type: integer
                        type: array
                      conditions:
                        description: |-
                          conditions contains the summary state for the GPU Kernel Cache on the
                          Kubernetes node referenced by status.nodeName.
                        items:
                          description: Condition contains details for one aspect of
                            the current state of this API Resource.
                          properties:
                            lastTransitionTime:
                              description: |-
                                lastTransitionTime is the last time the condition transitioned from one status to another.
                                This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                              format: date-time
                              type: string
                            message:
                              description: |-
                                message is a human readable message indicating details about the transition.
                                This may be an empty string.
                              maxLength: 32768
                              type: string
                            observedGeneration:
                              description: |-
                                observedGeneration represents the .metadata.generation that the condition was set based upon.
                                For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                                with respect to the current state of the instance.
                              format: int64
                              minimum: 0
                              type: integer
                            reason:
                              description: |-
                                reason contains a programmatic identifier indicating the reason for the condition's last transition.
                                Producers of specific condition types may define expected values and meanings for this field,
                                and whether the values are considered a guaranteed API.
                                The value should be a CamelCase string.
                                This field may not be empty.
                              maxLength: 1024
                              minLength: 1
                              pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                              type: string
                            status:
                              description: status of the condition, one of True, False,
                                Unknown.
                              enum:
                              - "True"
                              - "False"
                              - Unknown
                              type: string
                            type:
                              description: type of condition in CamelCase or in foo.example.com/CamelCase.
                              maxLength: 316
                              pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                              type: string
                          required:
                          - lastTransitionTime
                          - message
                          - reason
                          - status
                          - type
                          type: object
                        type: array
                      incompatibleGPUs:
                        description: |-
                          incompatibleGPUs is the list of GPU ids that the extracted GPU Kernel Cache
                          is not compatible with. The ids refer back to the list of GPUs in
                          status.gpus.
                        items:
                          type: integer
                        type: array
                      lastUpdated:
                        description: |-
                          lastUpdated contains the timestamp of the last time this cache instance was
                          updated.
                        format: date-time
                        type: string
                      volumeIds:
                        description: |-
                          volumeIds is the list of Volume Ids the CSI Driver received from Kubelet.
                          Each Id represents a GPU Kernel Cache that is actively Volume Mounted in a
                          pod.
                        items:
                          type: string
                        type: array
                      volumeSize:
                        description: volumeSize is the size of the extracted GPU Kernel
                          Cache in bytes.
                        format: int64
                        type: integer
                    required:
                    - lastUpdated
                    type: object
                  type: object
                description: |-
                  caches is the list of GKMCache or ClusterGKMCache instances that this
                  GKMCacheNode or ClusterGKMCacheNode is keeping status for along with state
                  for each.
                type: object
              counts:
                description: |-
                  counts contains statistics on the deployment of the GPU Kernel Cache for the
                  Kubernetes node referenced in nodeName.
                properties:
                  nodeCnt:
                    description: |-
                      nodeCnt contains the total number of nodes used in the collection of
                      counts. For GKMCacheNode and ClusterGKMCacheNode, the value will be one.
                      For GKMCache and ClusterGKMCache, the value will be number of nodes GKM is
                      deployed on.
                    type: integer
                  nodeErrorCnt:
                    description: |-
                      nodeErrorCnt contains the total number of nodes that the Kernel Cache
                      encounter an error. An error occurs if the OCI Image could not be extracted
                      because of an error in the image, or if the Kernel Cache is not compatible
                      with any of the GPUs detected on the Kubernetes node.
                    type: integer
                  nodeInUseCnt:
                    description: |-
                      nodeInUseCnt contains the total number of nodes that the Kernel Cache has
                      been extracted and that the Kernel Cache is currently being used by one or
                      more pods on that node.
                    type: integer
                  nodeNotInUseCnt:
                    description: |-
                      nodeNotInUseCnt contains the total number of nodes that the Kernel Cache
                      has been extracted and that the Kernel Cache is not currently being used by
                      a pod on that node.
                    type: integer
                  podOutdatedCnt:
                    description: |-
                      podOutdatedCnt contains the total number of pods that the Kernel Cache is
                      volume mounted, but a newer version of the extracted Kernel Cache has been
                      extracted. This happens when a Kernel Cache is being used, but the
                      associated OCI Image was updated.
                    type: integer
                  podRunningCnt:
                    description: |-
                      podRunningCnt contains the total number of pods that the Kernel Cache is
                      volume mounted.
                    type: integer
                required:
                - nodeCnt
                - nodeErrorCnt
                - nodeInUseCnt
                - nodeNotInUseCnt
                - podOutdatedCnt
                - podRunningCnt
                type: object
              gpus:
                description: |-
                  gpus is a list of GPUs detected on the Kubernetes Node along with metadata
                  about each GPU.
                items:
                  properties:
                    driverVersion:
                      description: driverVersion is the version of device driver managing
                        the GPU.
                      type: string
                    gpuType:
                      description: gpuType is the Product Name of the detected GPU.
                      type: string
                    ids:
                      description: |-
                        ids is a list of GPU indexes. GPUs of the same type are grouped together and
                        this is the list of indexes associated with the same GPU Type and attributes.
                      items:
                        type: integer
                      type: array
                  type: object
                type: array
              nodeName:
                description: nodeName is the name of the Kubernetes Node this instance
                  is created.
                type: string
            required:
            - counts
            - nodeName
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
